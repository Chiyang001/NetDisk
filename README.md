# NetDisk 私有云盘

<div align="center">

![Version](https://img.shields.io/badge/version-Ver.2026--0101Beta-blue)
![Python](https://img.shields.io/badge/python-3.7+-green)
![Flask](https://img.shields.io/badge/flask-3.0.0-orange)
![License](https://img.shields.io/badge/license-MIT-brightgreen)

一个功能强大、界面美观的私有云盘系统，支持文件管理、在线预览、主题切换等功能。

[功能特性](#功能特性) • [快速开始](#快速开始) • [使用说明](#使用说明) • [截图展示](#截图展示) • [常见问题](#常见问题)

</div>

---

## ✨ 功能特性

### 📁 文件管理
- ✅ 文件/文件夹上传（支持拖拽上传）
- ✅ 文件夹批量上传（保持目录结构）
- ✅ 多文件夹连续选择上传
- ✅ 文件/文件夹下载（文件夹自动打包为 ZIP）
- ✅ 文件/文件夹重命名、删除、复制、移动
- ✅ 新建文件夹
- ✅ 多选功能（批量复制、移动、删除、分享）
- ✅ 文件分享（支持设置有效期）
- ✅ 批量分享（一个链接分享多个文件）

### 🎨 界面与主题
- ✅ 毛玻璃透明风格设计
- ✅ 浅色/深色主题切换
- ✅ 自定义背景图片
- ✅ 纯色背景支持
- ✅ 响应式设计，完美支持移动端
- ✅ 拖拽上传视觉反馈

### 👁️ 文件预览
- ✅ 图片在线预览（支持 JPG, PNG, GIF, WEBP 等）
- ✅ 视频在线播放（支持 MP4, WEBM, OGG 等）
- ✅ 音频在线播放（支持 MP3, WAV, OGG, M4A, AAC, FLAC 等）
- ✅ PDF 在线预览（浏览器内置查看器）
- ✅ Office 文档在线预览（Word, Excel, PPT）
- ✅ 压缩包内容在线查看（ZIP, TAR, GZ, BZ2）
- ✅ 图片缩略图显示
- ✅ 视频/音频文件图标标识
- ✅ 压缩包文件识别

### 📊 视图与排序
- ✅ 列表视图 / 网格视图切换
- ✅ 按名称、时间、大小排序
- ✅ 升序/降序切换
- ✅ 视图偏好记忆

### 🔐 安全与设置
- ✅ 密码登录保护
- ✅ 密码 Hash 加密存储
- ✅ 修改登录密码
- ✅ Session 持久化（7天有效期）
- ✅ 清空缓存功能
- ✅ 清空所有数据功能

### 📤 上传优化
- ✅ 实时上传进度显示
- ✅ 上传速度显示（平滑计算）
- ✅ 预估剩余时间
- ✅ 已传输大小显示
- ✅ 批量上传支持（并发上传）
- ✅ 上传进度遮罩层（防止误操作）

### 🔗 分享功能
- ✅ 单文件/文件夹分享
- ✅ 批量分享（多个文件一个链接）
- ✅ 分享链接有效期设置
- ✅ 分享详情页（显示文件信息）
- ✅ 批量分享文件列表展示
- ✅ 单个文件下载 / 全部打包下载
- ✅ 分享页面背景与系统一致

### 🗂️ 其他功能
- ✅ 压缩包在线查看内容（无需解压）
- ✅ 从压缩包中下载单个文件
- ✅ 压缩包一键解压（ZIP, TAR, GZ, BZ2 等）
- ✅ 智能文件名冲突处理（自动重命名）
- ✅ 文件夹打包缓存（24小时自动清理）
- ✅ 右键菜单操作
- ✅ 移动端长按菜单支持
- ✅ 面包屑导航
- ✅ 剪贴板功能（复制/移动）
- ✅ 中文文件名完美支持
- ✅ 全选/取消全选
- ✅ 检查更新（跳转到 GitHub Releases）

---

## 🚀 快速开始

### 环境要求

- Python 3.7+
- pip 包管理器

### 安装步骤

1. **克隆项目**
```bash
git clone https://github.com/Chiyang001/NetDisk.git
cd NetDisk
```

2. **安装依赖**
```bash
pip install -r requirements.txt
```

3. **运行程序**
```bash
python app.py
```

4. **访问系统**
- 打开浏览器访问：`http://localhost:5000`
- 默认密码：`123456`
- **重要**：首次登录后请立即修改密码！

### Docker 部署（可选）

```bash
# 构建镜像
docker build -t netdisk .

# 运行容器
docker run -d -p 5000:5000 -v ./storage:/app/storage netdisk
```

---

## 📖 使用说明

### 首次登录

1. 使用默认密码 `123456` 登录
2. 登录后点击右上角"设置"按钮
3. 在"修改密码"区域修改为自己的密码

### 文件上传

**上传文件：**
1. 点击"上传文件"按钮
2. 选择一个或多个文件
3. 等待上传完成

**上传文件夹：**
1. 点击"上传文件夹"按钮
2. 选择要上传的文件夹
3. 可以点击"继续添加文件夹"选择更多文件夹
4. 点击"开始上传"批量上传所有选中的文件夹
5. 系统会保持原有目录结构

**拖拽上传：**
1. 直接从文件管理器拖拽文件/文件夹到浏览器窗口
2. 释放鼠标即可开始上传
3. 支持同时拖拽多个文件夹

### 文件操作

**右键菜单：**
- 在文件/文件夹上右键点击（移动端长按）
- 选择相应操作：预览、下载、分享、重命名、复制、移动、删除

**快捷操作：**
- 单击文件夹：进入文件夹
- 单击图片/视频/PDF：在线预览
- 单击 Office 文档：提示下载
- 单击其他文件：下载文件

### 多选功能

**进入多选模式：**
1. 点击顶部的"多选"按钮
2. 所有文件前会显示复选框
3. 勾选需要操作的文件

**批量操作：**
- **批量复制**：选中文件后点击"复制"，到目标文件夹粘贴
- **批量移动**：选中文件后点击"移动"，到目标文件夹粘贴
- **批量删除**：选中文件后点击"删除"，确认后删除
- **批量分享**：选中文件后点击"分享"，生成一个包含所有文件的分享链接

**全选功能：**
- 多选模式下，顶部会显示"全选"复选框
- 点击可快速选中/取消所有文件

### 视图切换

**列表视图：**
- 显示详细信息（名称、时间、大小）
- 适合查看文件详情

**网格视图：**
- 紧凑的卡片式布局
- 显示大图标/缩略图
- 适合浏览大量文件

### 排序功能

1. 点击顶部的"名称"、"时间"或"大小"按钮
2. 点击箭头按钮切换升序/降序
3. 排序设置会保存在 URL 中

### 主题设置

1. 进入"设置"页面
2. 在"主题设置"区域选择浅色或深色主题
3. 点击"保存主题"

### 背景设置

**图片背景：**
1. 进入"设置"页面
2. 选择"图片背景"
3. 上传自己的背景图片

**纯色背景：**
1. 进入"设置"页面
2. 选择"纯色背景"
3. 使用颜色选择器选择颜色

### 文件分享

**单文件分享：**
1. 右键点击文件/文件夹
2. 选择"分享文件"
3. 设置有效期（分钟，0为永久）
4. 复制分享链接发送给他人

**批量分享：**
1. 点击"多选"按钮进入多选模式
2. 勾选要分享的多个文件/文件夹
3. 点击"分享"按钮
4. 设置有效期
5. 生成一个包含所有文件的分享链接
6. 接收者可以查看文件列表，选择下载单个文件或全部打包下载

### 文件预览

**支持预览的格式：**
- 图片：JPG, JPEG, PNG, GIF, BMP, WEBP, SVG, ICO
- 视频：MP4, WEBM, OGG, MOV, AVI, MKV, FLV, WMV
- 音频：MP3, WAV, OGG, M4A, AAC, FLAC, WMA, APE, OPUS
- PDF：所有 PDF 文档
- Office 文档：Word (.doc, .docx), Excel (.xls, .xlsx), PowerPoint (.ppt, .pptx)

**音频播放：**
- 点击音频文件自动打开播放器
- 支持播放控制（播放/暂停、进度条、音量调节）
- 美观的毛玻璃效果播放器界面

**Office 文档预览：**
- 使用 Python 库将 Office 文档转换为 HTML 进行预览
- Word 文档：提取文本、段落、表格等内容
- Excel 表格：显示所有工作表和数据（限制显示 1000 行）
- PowerPoint：按幻灯片顺序显示文本内容
- 无需外部服务，完全本地化处理
- 支持中文内容显示
- 美观的毛玻璃效果界面

**实现方式：**
- Word (.docx) - 使用 python-docx 库解析
- Excel (.xlsx) - 使用 openpyxl 库解析
- PowerPoint (.pptx) - 使用 python-pptx 库解析
- 旧版 Office 格式 (.doc, .xls, .ppt) 需要先转换为新格式

**注意事项：**
- Office 文档预览为纯文本和表格内容，不包含图片和复杂格式
- 对于包含大量图片或复杂格式的文档，建议下载后使用 Office 软件查看
- Excel 表格每个工作表最多显示 1000 行数据

### 压缩包查看与解压

**支持的压缩格式：**
- ✅ ZIP 格式（完全支持，包括中文文件名）
- ✅ RAR 格式（完全支持，需要安装 rarfile 库）
- ✅ 7Z 格式（完全支持，需要安装 py7zr 库）
- ✅ TAR 格式及其变体（.tar, .tar.gz, .tgz, .tar.bz2, .tbz2, .tar.xz, .txz）
- ✅ GZ 单文件压缩（.gz）
- ✅ BZ2 单文件压缩（.bz2）

**安装额外的压缩格式支持：**
```bash
# 安装 RAR 支持
pip install rarfile

# 安装 7Z 支持
pip install py7zr

# 或一次性安装所有依赖
pip install -r requirements.txt
```

**在线查看压缩包内容：**
1. 点击压缩包文件
2. 自动打开压缩包内容查看页面
3. 显示文件列表、文件数量、总大小等信息
4. 可以下载压缩包中的单个文件
5. 也可以一键解压所有文件

**从压缩包下载单个文件：**
1. 在压缩包内容页面中
2. 找到需要的文件
3. 点击文件右侧的"下载"按钮
4. 系统会自动提取该文件并下载
5. 无需解压整个压缩包

**解压压缩包：**
1. 在压缩包内容页面点击"解压全部"按钮
2. 或右键点击压缩包文件，选择"解压到此处"
3. 确认解压操作
4. 等待解压完成（会显示加载提示）
5. 解压完成后页面自动刷新

**功能特点：**
- 无需解压即可查看压缩包内容
- 支持从压缩包中下载单个文件
- 支持 ZIP、RAR、7Z、TAR 等主流格式
- 自动创建以压缩包名称命名的文件夹
- 智能处理文件名冲突（自动添加数字后缀）
- 支持中文文件名的正确解压
- 显示详细的文件信息（大小、类型）
- 显示解压进度提示

### 系统维护

**清空缓存：**
- 删除临时 ZIP 文件和旧背景图片
- 不影响云盘文件和设置

**清空所有数据：**
- ⚠️ 危险操作！会删除所有文件和设置
- 需要输入 `DELETE ALL` 确认
- 密码会重置为默认密码 `123456`

**检查更新：**
- 点击"检查更新"按钮
- 跳转到 GitHub Releases 页面查看最新版本

---

## 📸 截图展示

### 登录页面
- 毛玻璃透明效果
- 默认密码提示
- 支持自定义背景

### 主页面
- 文件列表/网格视图
- 排序和筛选功能
- 实时上传进度

### 设置页面
- 主题切换
- 背景自定义
- 密码修改
- 系统维护

### 预览页面
- 图片在线预览
- 视频在线播放
- 下载和关闭按钮

---

## 🗂️ 项目结构

```
NetDisk/
├── app.py                  # 主程序
├── requirements.txt        # 依赖列表
├── README.md              # 项目说明
├── static/                # 静态文件
│   ├── bg.png            # 默认背景图片
│   └── bg_*.jpg/png      # 用户上传的背景图片
├── templates/             # 模板文件
│   ├── index.html        # 主页面
│   ├── login.html        # 登录页面
│   ├── settings.html     # 设置页面
│   ├── preview.html      # 图片/视频/音频预览页面
│   ├── document_preview.html  # 文档预览页面
│   ├── archive_view.html # 压缩包内容查看页面
│   ├── share.html        # 单文件分享页面
│   └── batch_share.html  # 批量分享页面
├── storage/              # 用户文件存储
├── folderzip/            # ZIP 临时文件（24小时自动清理）
└── instance/             # 数据库文件
    └── disk.db
```

---

## ⚙️ 配置说明

### 默认配置

```python
# 端口
PORT = 5000

# 默认密码
DEFAULT_PASSWORD = '123456'

# Session 有效期
SESSION_LIFETIME = 7天

# ZIP 文件保留时间
ZIP_RETENTION = 24小时
```

### 修改端口

编辑 `app.py` 文件最后一行：

```python
if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5000)  # 修改 port 参数
```

### 修改默认密码

编辑 `app.py` 文件中的 `DEFAULT_PASSWORD` 常量：

```python
DEFAULT_PASSWORD = '你的密码'
```

---

## 🔧 技术栈

### 后端
- **Flask** - Web 框架
- **SQLAlchemy** - ORM 数据库
- **Werkzeug** - 密码加密
- **Pillow** - 图片处理
- **zipfile** - ZIP 压缩包处理（标准库）
- **tarfile** - TAR 压缩包处理（标准库）
- **gzip/bz2** - 压缩文件处理（标准库）
- **rarfile** - RAR 压缩包处理
- **py7zr** - 7Z 压缩包处理
- **python-docx** - Word 文档处理
- **openpyxl** - Excel 表格处理
- **python-pptx** - PowerPoint 处理

### 前端
- **Bootstrap 5** - UI 框架
- **Bootstrap Icons** - 图标库
- **JavaScript** - 交互逻辑
- **CSS3** - 毛玻璃效果

### 数据库
- **SQLite** - 轻量级数据库

---

## 📋 依赖列表

```
Flask==3.0.0
Flask-SQLAlchemy==3.1.1
shortuuid==1.0.11
Pillow==10.1.0
Werkzeug==3.0.1
rarfile==4.1
py7zr==0.20.8
python-docx==1.1.0
openpyxl==3.1.2
python-pptx==0.6.23
```

---

## 🐛 常见问题

### Q: 复制/移动文件时提示错误？

**常见错误：**
- WinError: No such file or directory
- 文件已存在

**解决方案：**
- 系统已自动处理文件名冲突，会添加"_副本"后缀
- 如果仍然失败，检查源文件和目标文件夹是否存在
- 确保有足够的磁盘空间
- 检查文件是否被其他程序占用

### Q: 压缩包无法查看或解压失败？

**常见原因：**
- 压缩包损坏或不完整
- 缺少必要的库（RAR 需要 rarfile，7Z 需要 py7zr）
- 磁盘空间不足
- 文件名编码问题
- 压缩包过大导致超时

**解决方案：**
1. **确保安装了所有依赖库：**
```bash
pip install -r requirements.txt
```

2. **单独安装 RAR 支持：**
```bash
pip install rarfile
```

3. **单独安装 7Z 支持：**
```bash
pip install py7zr
```

4. **其他检查：**
- 确保压缩包完整且未损坏
- 检查磁盘空间是否充足
- 对于超大压缩包，建议分卷压缩或使用更小的文件

**支持的格式说明：**
- ✅ ZIP - 完全支持（标准库）
- ✅ TAR/TAR.GZ/TAR.BZ2 - 完全支持（标准库）
- ✅ GZ/BZ2 单文件 - 完全支持（标准库）
- ✅ RAR - 需要安装 rarfile 库
- ✅ 7Z - 需要安装 py7zr 库

### Q: RAR 文件提示需要安装库？

**错误信息：**
```
RAR 格式需要安装 rarfile 库，请运行: pip install rarfile
```

**解决方案：**
```bash
pip install rarfile
```

安装后重启应用即可支持 RAR 格式。

### Q: 7Z 文件提示需要安装库？

**错误信息：**
```
7Z 格式需要安装 py7zr 库，请运行: pip install py7zr
```

**解决方案：**
```bash
pip install py7zr
```

安装后重启应用即可支持 7Z 格式。

### Q: 从压缩包下载单个文件很慢？

**原因：**
- 系统需要先提取文件到临时目录
- 大文件提取需要时间
- 压缩包本身很大

**解决方案：**
- 耐心等待文件提取完成
- 对于经常使用的文件，建议先解压整个压缩包
- 使用压缩率较低的压缩方式以加快提取速度

### Q: Office 文档预览失败？

**常见原因：**
- 缺少必要的 Python 库
- 文档格式不支持（旧版 .doc, .xls, .ppt）
- 文档损坏或加密
- 文档过大或过于复杂

**解决方案：**
1. **确保安装了所有依赖库：**
```bash
pip install python-docx openpyxl python-pptx
```

2. **旧版 Office 格式：**
- 旧版格式 (.doc, .xls, .ppt) 需要先用 Office 软件转换为新格式 (.docx, .xlsx, .pptx)
- 或者直接下载文件使用 Office 软件打开

3. **文档包含复杂格式：**
- 预览功能主要显示文本和表格内容
- 对于包含大量图片、图表、复杂格式的文档，建议下载后查看

4. **文档加密或损坏：**
- 加密的文档无法预览，需要下载后输入密码
- 损坏的文档无法解析，请检查文件完整性

### Q: 音频无法播放？

**原因：**
- 浏览器不支持该音频格式
- 音频编码不兼容

**解决方案：**
- 使用 MP3 格式（兼容性最好）
- 更新浏览器到最新版本
- 或直接下载后使用本地播放器

### Q: 忘记密码怎么办？

**方法一：清空所有数据**
1. 删除 `instance/disk.db` 文件
2. 重启程序
3. 使用默认密码 `123456` 登录

**方法二：直接修改数据库**
1. 使用 SQLite 工具打开 `instance/disk.db`
2. 修改 `settings` 表中的 `password_hash` 字段

### Q: 上传大文件失败？

**解决方案：**
1. 检查磁盘空间是否充足
2. 增加 Flask 上传大小限制（在 `app.py` 中添加）：
```python
app.config['MAX_CONTENT_LENGTH'] = 1024 * 1024 * 1024  # 1GB
```

### Q: 图片缩略图不显示？

**原因：**
- Pillow 库未正确安装
- 图片格式不支持

**解决方案：**
```bash
pip install --upgrade Pillow
```

### Q: 视频无法播放？

**原因：**
- 浏览器不支持该视频格式
- 视频编码不兼容

**解决方案：**
- 使用 MP4 格式（H.264 编码）
- 或直接下载后使用本地播放器

### Q: 移动端体验不佳？

**解决方案：**
- 使用网格视图
- 启用浏览器的"桌面模式"
- 更新到最新版本

### Q: ZIP 文件占用空间过大？

**解决方案：**
- 在设置页面点击"清空缓存"
- 或手动删除 `folderzip` 目录中的文件
- 系统会每24小时自动清理

---

## 🔒 安全建议

1. **修改默认密码**
   - 首次登录后立即修改
   - 使用强密码（至少8位，包含字母、数字、符号）

2. **定期备份**
   - 定期备份 `storage` 目录
   - 备份 `instance/disk.db` 数据库文件

3. **网络安全**
   - 不要将系统直接暴露在公网
   - 使用反向代理（Nginx）
   - 启用 HTTPS

4. **访问控制**
   - 使用防火墙限制访问
   - 定期更换密码
   - 及时更新系统

---

## 🚀 性能优化

### 生产环境部署

**使用 Gunicorn：**
```bash
pip install gunicorn
gunicorn -w 4 -b 0.0.0.0:5000 app:app
```

**使用 Nginx 反向代理：**
```nginx
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://127.0.0.1:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

### 性能建议

1. **文件数量**：单个文件夹建议不超过 1000 个文件
2. **文件大小**：单个文件建议不超过 2GB
3. **并发上传**：建议不超过 5 个文件同时上传
4. **定期清理**：定期清理不需要的文件和缓存

---

## 📝 更新日志

### Ver.2026-0101Beta (当前版本)
- ✨ 新增压缩包内容在线查看功能（无需解压）
- ✨ 新增从压缩包中下载单个文件功能
- ✨ 新增音频在线播放功能（MP3, WAV, OGG, M4A, AAC, FLAC 等）
- ✨ 新增 Office 文档在线预览（Word, Excel, PPT）
- ✨ 新增压缩包在线解压功能（ZIP, TAR, GZ, BZ2）
- ✨ 新增压缩包文件类型识别和图标显示
- ✨ 新增智能文件名冲突处理（自动重命名）
- ✨ 新增列表/网格视图切换
- ✨ 新增文件排序功能（名称、时间、大小）
- ✨ 新增主题切换（浅色/深色）
- ✨ 新增自定义背景（图片/纯色）
- ✨ 新增实时上传进度显示（速度、剩余时间）
- ✨ 新增图片/视频在线预览
- ✨ 新增 PDF 在线预览
- ✨ 新增 Office 文档类型识别
- ✨ 新增文件夹批量上传（支持多次选择）
- ✨ 新增拖拽上传（支持多文件夹）
- ✨ 新增多选功能（批量操作）
- ✨ 新增批量复制/移动/删除
- ✨ 新增批量分享（一个链接分享多个文件）
- ✨ 新增分享文件列表页面（可单独下载）
- ✨ 新增全选/取消全选功能
- ✨ 新增清空缓存功能
- ✨ 新增检查更新功能
- ✨ 新增上传进度遮罩层
- ✨ 新增移动端长按菜单支持
- ✨ 优化压缩包处理体验（点击查看，右键解压）
- ✨ 优化移动端体验
- ✨ 优化毛玻璃效果
- ✨ 优化上传速度计算（平滑算法）
- ✨ 优化分享页面背景（与系统一致）
- 🐛 修复音频文件点击下载而非预览的问题
- 🐛 修复复制/移动文件时的 WinError 错误
- 🐛 修复文件名冲突导致的操作失败
- 🐛 修复中文文件名问题
- 🐛 修复文件夹下载问题
- 🐛 修复登录状态丢失问题
- 🐛 修复上传窗口被遮挡问题
- 🐛 修复底栏层级问题

---

## 🤝 贡献指南

欢迎提交 Issue 和 Pull Request！

### 提交 Issue
- 描述问题或建议
- 提供复现步骤
- 附上截图（如果可能）

### 提交 PR
1. Fork 本项目
2. 创建新分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 开启 Pull Request

---

## 📄 开源协议

本项目采用 MIT 协议开源，详见 [LICENSE](LICENSE) 文件。

---

## 👨‍💻 作者信息

**炽阳001**

- 📧 QQ：3083248889
- 🐙 GitHub：[@Chiyang001](https://github.com/Chiyang001)
- 📺 哔哩哔哩：[炽阳001](https://space.bilibili.com/404891612)
- 🔗 项目地址：[NetDisk](https://github.com/Chiyang001/NetDisk)

---

## ⭐ Star History

如果这个项目对你有帮助，请给个 Star ⭐ 支持一下！

---

## 💖 致谢

感谢所有使用和支持本项目的朋友们！

特别感谢以下开源项目：
- [Flask](https://flask.palletsprojects.com/)
- [Bootstrap](https://getbootstrap.com/)
- [Bootstrap Icons](https://icons.getbootstrap.com/)
- [Pillow](https://python-pillow.org/)

---

<div align="center">

**如有问题或建议，欢迎联系作者！**

Made with ❤️ by 炽阳001

</div>
