<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文档预览 - {{ file_name }}</title>
    <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.bootcdn.net/ajax/libs/bootstrap-icons/1.10.0/font/bootstrap-icons.min.css" rel="stylesheet">
    <style>
        body {
            margin: 0;
            padding: 0;
            min-height: 100vh;
            background: #f5f5f5;
            display: flex;
            flex-direction: column;
        }
        
        .preview-header {
            background: white;
            border-bottom: 1px solid #e0e0e0;
            padding: 15px 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            z-index: 1000;
        }
        
        .preview-header h5 {
            margin: 0;
            font-size: 1.1rem;
            word-break: break-all;
            color: #333;
        }
        
        .preview-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: white;
            position: relative;
        }
        
        .preview-iframe {
            flex: 1;
            border: none;
            width: 100%;
            min-height: calc(100vh - 70px);
        }
        
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            z-index: 999;
        }
        
        .loading-overlay.hidden {
            display: none;
        }
        
        .spinner-border {
            width: 3rem;
            height: 3rem;
            color: #0d6efd;
        }
        
        .btn-custom {
            background: #0d6efd;
            color: white;
            border: none;
            transition: all 0.3s ease;
        }
        
        .btn-custom:hover {
            background: #0b5ed7;
            color: white;
            transform: translateY(-2px);
        }
        
        .btn-close-custom {
            background: #6c757d;
            color: white;
            border: none;
        }
        
        .btn-close-custom:hover {
            background: #5c636a;
            color: white;
        }
        
        .error-message {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }
        
        .error-message i {
            font-size: 4rem;
            color: #dc3545;
            margin-bottom: 20px;
        }
        
        .error-message h4 {
            margin-bottom: 15px;
        }
        
        .error-message p {
            margin-bottom: 20px;
        }
        
        .info-box {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            border-radius: 8px;
            padding: 15px;
            margin: 20px;
            color: #004085;
        }
        
        .info-box i {
            font-size: 1.5rem;
            margin-right: 10px;
        }
        
        @media (max-width: 768px) {
            .preview-header h5 {
                font-size: 0.95rem;
            }
            
            .preview-header .btn {
                font-size: 0.85rem;
                padding: 6px 12px;
            }
            
            .btn-text {
                display: none;
            }
        }
    </style>
</head>
<body>

<div class="preview-header d-flex justify-content-between align-items-center">
    <h5><i class="bi bi-file-earmark-text me-2"></i>{{ file_name }}</h5>
    <div>
        <a href="/download?path={{ file_path }}" class="btn btn-custom me-2">
            <i class="bi bi-download"></i> <span class="btn-text">下载</span>
        </a>
        <a href="javascript:history.back()" class="btn btn-close-custom">
            <i class="bi bi-x-lg"></i> <span class="btn-text">关闭</span>
        </a>
    </div>
</div>

<div class="preview-content">
    {% if file_type == 'pdf' %}
    <!-- PDF 预览 - 使用浏览器内置查看器 -->
    <iframe id="preview-frame" 
            class="preview-iframe" 
            src="/file?path={{ file_path }}#toolbar=1&navpanes=1&scrollbar=1">
    </iframe>
    
    {% elif file_type == 'office' %}
    <!-- Office 文档预览提示 -->
    <div class="info-box">
        <i class="bi bi-info-circle-fill"></i>
        <strong>Office 文档预览说明：</strong>
        <p class="mb-2 mt-2">由于浏览器限制，Office 文档（Word、Excel、PPT）无法直接在线预览。</p>
        <p class="mb-0">建议您下载文件后使用 Microsoft Office 或 WPS 等软件打开。</p>
    </div>
    
    <div class="error-message">
        <i class="bi bi-file-earmark-word"></i>
        <h4>{{ file_name }}</h4>
        <p>Office 文档需要下载后查看</p>
        <a href="/download?path={{ file_path }}" class="btn btn-custom btn-lg">
            <i class="bi bi-download me-2"></i>下载文件
        </a>
        <div class="mt-4">
            <small class="text-muted">
                支持的软件：Microsoft Office、WPS Office、LibreOffice 等
            </small>
        </div>
    </div>
    
    {% else %}
    <!-- 不支持的文件类型 -->
    <div class="error-message">
        <i class="bi bi-file-earmark-x"></i>
        <h4>无法预览此文件</h4>
        <p>该文件类型不支持在线预览</p>
        <a href="/download?path={{ file_path }}" class="btn btn-custom">
            <i class="bi bi-download me-2"></i>下载文件
        </a>
    </div>
    {% endif %}
</div>

<script>
    {% if file_type == 'pdf' %}
    // PDF 加载监听
    const iframe = document.getElementById('preview-frame');
    
    iframe.onload = function() {
        console.log('PDF 加载成功');
    };
    
    iframe.onerror = function() {
        document.querySelector('.preview-content').innerHTML = `
            <div class="error-message">
                <i class="bi bi-exclamation-triangle"></i>
                <h4>PDF 加载失败</h4>
                <p>您的浏览器可能不支持 PDF 预览</p>
                <a href="/download?path={{ file_path }}" class="btn btn-custom">
                    <i class="bi bi-download me-2"></i>下载文件
                </a>
            </div>
        `;
    };
    {% endif %}
</script>

</body>
</html>
